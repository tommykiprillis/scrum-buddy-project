<%- include ("partials/header.ejs"); -%>

    <div class="mt-5 px-5 burndown-container">
            <span class="badge p-2 me-auto text-bg-dark rounded-pill mb-2"><%=sprintStatus%></span>
            <div class="d-flex gap-3 align-items-center">
                <h1 class="mb-2"><%= sprintDetails.name %></h1>	
            </div>
        
            <p class="fs-5 text-secondary mb-4"><%= new Date(sprintDetails.start_date).toLocaleDateString('en-AU', { day: '2-digit', month: '2-digit', year: 'numeric' }); %> - 
                <%= new Date(sprintDetails.end_date).toLocaleDateString('en-AU', { day: '2-digit', month: '2-digit', year: 'numeric' }); %>
            </p>
            <div class="d-flex justify-content-end">
                <a href="/viewSprint" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16">
                        <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"/>
                    </svg>
                View Sprint Board
                </a>
            </div>

        <canvas id="burndownChart"></canvas>
    </div>

    

    <script>
        // get the data passed from the server
        const actualData = JSON.parse('<%- actualBurndownData %>');
        const idealData = JSON.parse('<%- idealBurndownData %>');

        // generate labels based on the length of the data
        const labels = idealData.map((_, index) => `Day ${index + 1}`);

        // get the canvas context
        const ctx = document.getElementById('burndownChart').getContext('2d');

        // create a new line chart
        const burndownChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Actual Burndown',
                        data: actualData.map(data => data.storyPoints),
                        borderColor: 'rgba(255, 52, 48, 0.8)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: 'Ideal Burndown',
                        data: idealData.map(data => data.storyPoints),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        fill: false,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Story Points'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Days'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>